{
  "version": "v1",
  "family": "startup_ops",
  "captured_at": "2026-02-13T00:00:00Z",
  "description": "Mode-specific parity fixtures for startup operations (__libc_start_main, __frankenlibc_startup_phase0, __frankenlibc_startup_snapshot). All Implemented. Strict: deterministic startup sequence with explicit deny/fallback startup policy. Hardened: same startup ordering with the same policy outcomes.",
  "cases": [
    {
      "name": "startup_phase0_returns_strict",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": {},
      "expected_output": "PHASE0_COMPLETE",
      "expected_errno": 0,
      "mode": "strict",
      "note": "Phase-0 initialization completes successfully"
    },
    {
      "name": "startup_snapshot_valid_strict",
      "function": "__frankenlibc_startup_snapshot",
      "spec_section": "FrankenLibC startup",
      "inputs": {},
      "expected_output": "SNAPSHOT_VALID",
      "expected_errno": 0,
      "mode": "strict",
      "note": "Startup snapshot captures valid invariants"
    },
    {
      "name": "libc_start_main_entry_strict",
      "function": "__libc_start_main",
      "spec_section": "glibc __libc_start_main",
      "inputs": { "main": "valid_fn_ptr", "argc": 1, "argv": "valid_ptr" },
      "expected_output": "MAIN_CALLED",
      "expected_errno": 0,
      "mode": "strict",
      "note": "main function is called with correct argc/argv"
    },
    {
      "name": "startup_phase0_returns_hardened",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": {},
      "expected_output": "PHASE0_COMPLETE",
      "expected_errno": 0,
      "mode": "hardened"
    },
    {
      "name": "startup_snapshot_valid_hardened",
      "function": "__frankenlibc_startup_snapshot",
      "spec_section": "FrankenLibC startup",
      "inputs": {},
      "expected_output": "SNAPSHOT_VALID",
      "expected_errno": 0,
      "mode": "hardened"
    },
    {
      "name": "startup_phase0_rejects_unterminated_auxv_strict",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": { "auxv": "unterminated_pairs_max_scan", "argc": 1, "argv": "valid_ptr" },
      "expected_output": "DENY_INVALID_STARTUP_CONTEXT",
      "expected_errno": 7,
      "mode": "strict",
      "note": "Auxv scan without AT_NULL terminator must deterministically deny with E2BIG"
    },
    {
      "name": "startup_phase0_rejects_unterminated_auxv_hardened",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": { "auxv": "unterminated_pairs_max_scan", "argc": 1, "argv": "valid_ptr" },
      "expected_output": "DENY_INVALID_STARTUP_CONTEXT",
      "expected_errno": 7,
      "mode": "hardened",
      "note": "Hardened mode keeps startup deny policy deterministic for invalid auxv contexts"
    },
    {
      "name": "startup_phase0_rejects_unterminated_argv_strict",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": { "argv": "unterminated_ptrs_max_scan", "argc": 1, "auxv": "terminated_nonsecure" },
      "expected_output": "DENY_INVALID_STARTUP_CONTEXT",
      "expected_errno": 7,
      "mode": "strict",
      "note": "Argv scan without NULL terminator must deny with E2BIG"
    },
    {
      "name": "startup_phase0_rejects_unterminated_argv_hardened",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": { "argv": "unterminated_ptrs_max_scan", "argc": 1, "auxv": "terminated_nonsecure" },
      "expected_output": "DENY_INVALID_STARTUP_CONTEXT",
      "expected_errno": 7,
      "mode": "hardened"
    },
    {
      "name": "startup_phase0_rejects_unterminated_envp_strict",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": {
        "argv": "valid_ptr",
        "envp": "unterminated_ptrs_max_scan",
        "argc": 1,
        "auxv": "terminated_nonsecure"
      },
      "expected_output": "DENY_INVALID_STARTUP_CONTEXT",
      "expected_errno": 7,
      "mode": "strict",
      "note": "Envp scan without NULL terminator must deny with E2BIG"
    },
    {
      "name": "startup_phase0_rejects_unterminated_envp_hardened",
      "function": "__frankenlibc_startup_phase0",
      "spec_section": "FrankenLibC startup",
      "inputs": {
        "argv": "valid_ptr",
        "envp": "unterminated_ptrs_max_scan",
        "argc": 1,
        "auxv": "terminated_nonsecure"
      },
      "expected_output": "DENY_INVALID_STARTUP_CONTEXT",
      "expected_errno": 7,
      "mode": "hardened"
    },
    {
      "name": "startup_snapshot_secure_mode_nonsecure_strict",
      "function": "__frankenlibc_startup_snapshot",
      "spec_section": "FrankenLibC startup",
      "inputs": { "auxv": "at_secure_zero_then_null", "argc": 1, "argv": "valid_ptr" },
      "expected_output": "SNAPSHOT_VALID_SECURE0",
      "expected_errno": 0,
      "mode": "strict",
      "note": "AT_SECURE=0 classifies as non-secure mode"
    },
    {
      "name": "startup_snapshot_secure_mode_secure_hardened",
      "function": "__frankenlibc_startup_snapshot",
      "spec_section": "FrankenLibC startup",
      "inputs": { "auxv": "at_secure_one_then_null", "argc": 1, "argv": "valid_ptr" },
      "expected_output": "SNAPSHOT_VALID_SECURE1",
      "expected_errno": 0,
      "mode": "hardened",
      "note": "AT_SECURE=1 must persist secure-mode invariant in hardened mode"
    },
    {
      "name": "libc_start_main_phase0_disabled_fallback_host_strict",
      "function": "__libc_start_main",
      "spec_section": "glibc __libc_start_main",
      "inputs": { "phase0_env": "0", "main": "valid_fn_ptr", "argc": 1, "argv": "valid_ptr" },
      "expected_output": "FALLBACK_HOST_DELEGATE",
      "expected_errno": 0,
      "mode": "strict",
      "note": "When phase-0 is disabled, startup must delegate directly to host"
    },
    {
      "name": "libc_start_main_phase0_unsafe_envp_fallback_host_strict",
      "function": "__libc_start_main",
      "spec_section": "glibc __libc_start_main",
      "inputs": {
        "phase0_env": "1",
        "main": "valid_fn_ptr",
        "argc": 1,
        "argv": "valid_ptr",
        "envp": "unterminated_ptrs_max_scan"
      },
      "expected_output": "PHASE0_DENY_THEN_FALLBACK_HOST",
      "expected_errno": 0,
      "mode": "strict",
      "note": "Unsafe phase-0 envp context must fallback to host when delegation is available"
    },
    {
      "name": "libc_start_main_phase0_missing_main_no_fallback_strict",
      "function": "__libc_start_main",
      "spec_section": "glibc __libc_start_main",
      "inputs": { "phase0_env": "1", "main": "null", "argc": 1, "argv": "valid_ptr" },
      "expected_output": "DENY_MISSING_MAIN_NO_FALLBACK",
      "expected_errno": 22,
      "mode": "strict",
      "note": "Missing main pointer is a hard deny and must not fallback to host"
    }
  ]
}
