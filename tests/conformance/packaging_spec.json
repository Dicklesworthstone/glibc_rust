{
  "schema_version": 1,
  "bead": "bd-30h",
  "description": "Packaging specification for glibc_rust build artifacts. Defines two products (Interpose and Replace), their build commands, deployment models, and symbol-level guarantee contracts.",
  "artifacts": {
    "interpose": {
      "name": "Interpose",
      "artifact_name": "libglibc_rs_abi.so",
      "description": "LD_PRELOAD-safe shared library that interposes over host glibc. Call-throughs to host glibc are allowed for unimplemented subsystems. Primary value: transparent safety membrane + structured logging.",
      "build_command": "cargo build -p glibc-rs-abi --release",
      "output_path": "target/release/libglibc_rs_abi.so",
      "deployment": "LD_PRELOAD=target/release/libglibc_rs_abi.so <program>",
      "deployment_modes": {
        "strict": "GLIBC_RUST_MODE=strict LD_PRELOAD=target/release/libglibc_rs_abi.so <program>",
        "hardened": "GLIBC_RUST_MODE=hardened LD_PRELOAD=target/release/libglibc_rs_abi.so <program>"
      },
      "host_glibc_required": true,
      "allowed_statuses": ["Implemented", "RawSyscall", "GlibcCallThrough", "Stub"],
      "replacement_levels": ["L0", "L1"],
      "cargo_features": [],
      "cargo_profile": "release",
      "crate_type": "cdylib",
      "version_script": "crates/glibc-rs-abi/version_scripts/libc.map",
      "guarantee": "All exported symbols are safe to call. Membrane validates inputs. Unimplemented symbols delegate to host glibc or return deterministic stub errors."
    },
    "replace": {
      "name": "Replace",
      "artifact_name": "libglibc_rs_replace.so",
      "description": "Standalone replacement library with zero host glibc dependency for core primitives. All symbols are either natively implemented or use raw syscalls. Suitable for containers and minimal environments.",
      "build_command": "cargo build -p glibc-rs-abi --release --features=standalone",
      "output_path": "target/release/libglibc_rs_replace.so",
      "deployment": "Direct link as system libc or LD_PRELOAD (no host glibc call-throughs)",
      "deployment_modes": {
        "strict": "Direct link or LD_PRELOAD; strict mode is default",
        "hardened": "GLIBC_RUST_MODE=hardened with direct link or LD_PRELOAD"
      },
      "host_glibc_required": false,
      "allowed_statuses": ["Implemented", "RawSyscall"],
      "replacement_levels": ["L2", "L3"],
      "cargo_features": ["standalone"],
      "cargo_profile": "release",
      "crate_type": "cdylib",
      "version_script": "crates/glibc-rs-abi/version_scripts/libc.map",
      "guarantee": "All exported symbols are self-contained. Zero host glibc dependency. Every symbol either runs native Rust code or issues raw Linux syscalls.",
      "status": "planned",
      "blockers": {
        "total_symbols_to_migrate": 60,
        "GlibcCallThrough_remaining": {
          "stdio_abi": 30,
          "pthread_abi": 20,
          "dlfcn_abi": 4
        },
        "Stub_remaining": {
          "locale_abi": 2,
          "resolv_abi": 4
        },
        "milestone_beads": [
          {"bead": "bd-z84", "title": "Futex mutex core", "migrates": "pthread_mutex_* (part of 20)"},
          {"bead": "bd-yos", "title": "Thread bootstrap", "migrates": "pthread_create/join/detach (part of 20)"},
          {"bead": "bd-747", "title": "Stub wave 1: getenv/setenv", "migrates": "environment APIs"},
          {"bead": "bd-66s", "title": "Stub wave 2: resolver numeric", "migrates": "resolv_abi (4 stubs)"},
          {"bead": "bd-3pe", "title": "Locale phase-1", "migrates": "locale_abi (2 stubs)"},
          {"bead": "bd-3rn", "title": "rtld phase-1", "migrates": "dlfcn_abi (4 call-throughs)"},
          {"bead": "bd-qwm", "title": "CRT phase-0", "migrates": "bootstrap (_start)"}
        ]
      }
    }
  },
  "current_assessment": {
    "total_symbols": 227,
    "interpose_ready": 227,
    "replace_ready": 167,
    "replace_blocked": 60,
    "symbol_distribution": {
      "Implemented": 84,
      "RawSyscall": 83,
      "GlibcCallThrough": 54,
      "Stub": 6
    },
    "interpose_pct": 100,
    "replace_pct": 74
  },
  "naming_convention": {
    "interpose": {
      "so_name": "libglibc_rs_abi.so",
      "install_path": "/usr/lib/glibc-rust/libglibc_rs_abi.so",
      "env_activation": "LD_PRELOAD=/usr/lib/glibc-rust/libglibc_rs_abi.so"
    },
    "replace": {
      "so_name": "libglibc_rs_replace.so",
      "install_path": "/usr/lib/glibc-rust/libglibc_rs_replace.so",
      "system_link": "ln -sf /usr/lib/glibc-rust/libglibc_rs_replace.so /lib/x86_64-linux-gnu/libc.so.6"
    }
  },
  "feature_gates": {
    "default": {
      "description": "Default build produces Interpose artifact. GlibcCallThrough and Stub symbols are compiled in.",
      "features": []
    },
    "standalone": {
      "description": "Future feature gate for Replace artifact. When enabled, GlibcCallThrough symbols must have native implementations and Stub symbols must be eliminated.",
      "features": ["standalone"],
      "compile_time_enforcement": "cfg(feature = \"standalone\") gates should reject GlibcCallThrough dispatch at compile time",
      "status": "planned"
    },
    "runtime-math-production": {
      "description": "Enables production-tier runtime_math modules (barrier, bandit, control, risk, etc.).",
      "features": ["runtime-math-production"],
      "applies_to": "both"
    },
    "runtime-math-research": {
      "description": "Enables research-tier runtime_math modules (alien artifact modules).",
      "features": ["runtime-math-research"],
      "applies_to": "both"
    }
  },
  "matrix_applicability": {
    "description": "Every symbol in support_matrix.json applies to the Interpose artifact. Only Implemented and RawSyscall symbols apply to the Replace artifact.",
    "rule": "If status in (Implemented, RawSyscall) → applies to both. If status in (GlibcCallThrough, Stub) → Interpose only."
  }
}
